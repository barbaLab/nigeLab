function PlotFeatures(obj)
%% PLOTFEATURES  Plot cluster features from SORT UI in 3D and 2D.


% Loop through each subset of 3 features
curCh = obj.ChannelSelector.Channel;
feat = obj.Data.feat{curCh};
cl = obj.Data.class{curCh};

% Get TIME binning vector for plotting features vs time (mins)
ts = obj.Data.ts{curCh};

cla(obj.Features3D);
cla(obj.Features2D);

% randomly select spikes to plot
obj.rsel = false(size(obj.Data.spikes{curCh},1),1);

obj.rsel( randi( numel(obj.rsel),1,...
   min(obj.NFEAT_PLOT_POINTS,numel(obj.rsel)) ) ) = true;


for iC = 1:obj.NCLUS_MAX
   if obj.nFeat(curCh) < max(obj.featInd) 
      continue
   end
   

   if obj.NFEAT_PLOT_POINTS <= sum(obj.rsel & ...
         cl==iC)
      fi = cl==iC & ... % fi --> features included
         obj.rsel;   % include property no more available
   else
      fi = cl==iC;
   end
   
   if obj.VisibleClusters(iC) > 0
      state = 'on';
   else
      state = 'off';
   end

   
   X = feat(fi, obj.featInd);
   if sum(fi) > obj.MINSPIKES
      if iC > 1
         scatter3(obj.Features3D, ...
            feat(fi,obj.featInd(1)), ...
            feat(fi,obj.featInd(2)), ...
            ts(fi), ...
            5, 'filled',... % (size; filled markers)
            'MarkerFaceColor',obj.COLS{iC},...
            'MarkerEdgeColor','none', ...
            'Marker','o',...
            'Visible',state,...
            'UserData',iC);

         scatter(obj.Features2D,...
            feat(fi,obj.featInd(1)),...
            feat(fi,obj.featInd(2)),...
            5, 'filled',...
            'MarkerFaceColor',obj.COLS{iC},...
            'MarkerEdgeColor','none',...
            'Marker','o',...
            'Visible',state,...
            'UserData',iC,...
            'ButtonDownFcn',@obj.ButtonDownFcnSelect2D);
      else
         scatter3(obj.Features3D, ...
            feat(fi,obj.featInd(1)), ...
            feat(fi,obj.featInd(2)), ...
            ts(fi), ...
            5, 'filled',... % (size; filled markers)
            'MarkerFaceColor',[0.15 0.15 0.15],...
            'MarkerEdgeColor','none', ...
            'Marker','o',...
            'Visible',state,...
            'UserData',iC);

         scatter(obj.Features2D,...
            feat(fi,obj.featInd(1)),...
            feat(fi,obj.featInd(2)),...
            5, 'filled',...
            'MarkerFaceColor',[0.15 0.15 0.15],...
            'MarkerEdgeColor','none',...
            'Marker','o',...
            'Visible',state,...
            'UserData',iC,...
            'ButtonDownFcn',@obj.ButtonDownFcnSelect2D);
      end
   end
   
end

obj.ResetFeatureAxes;

end